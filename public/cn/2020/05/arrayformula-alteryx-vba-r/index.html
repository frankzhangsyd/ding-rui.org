<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Excel 数组公式 , Alteryx, VBA 与R - Dingrui</title>
    <meta property="og:title" content="Excel 数组公式 , Alteryx, VBA 与R - Dingrui">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="这个星期来PwC上班以后，第一次又重新干起了老本行，写VBA和做template （Excel Based）。
做template，最痛苦的事，莫过于design你的template。一方面要囊括尽可能多的，有用的信息给用户，另一方面又要考虑用户会怎么会去使用你的template (这一点我在悉尼大学工作的时候和Casey同学学习到了很多)。PwC又尤其注重你的效率，所以还得考虑到后续的功能增删所 &amp;hellip;">
      <meta property="og:description" content="这个星期来PwC上班以后，第一次又重新干起了老本行，写VBA和做template （Excel Based）。
做template，最痛苦的事，莫过于design你的template。一方面要囊括尽可能多的，有用的信息给用户，另一方面又要考虑用户会怎么会去使用你的template (这一点我在悉尼大学工作的时候和Casey同学学习到了很多)。PwC又尤其注重你的效率，所以还得考虑到后续的功能增删所 &amp;hellip;">
      
    

    
    

    

    
    


<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="/css/custom.css" />

  </head>

  
  <body class="cn">
    <header class="masthead">
      <h1><a href="/">Dingrui</a></h1>

<p class="tagline">Personal website of Dingrui(Frank)</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" hidden/>
  <label id="menu-label" for="menu-check" class="unselectable" hidden>
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/">首页</a></li>
  
  <li><a href="/cn/about/">关于</a></li>
  
  <li><a href="/cn/">日志</a></li>
  
  <li><a href="/cn/vitae/">简历</a></li>
  
  <li><a href="/en/">English</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>Excel 数组公式 , Alteryx, VBA 与R</h1>

<h3>Frank
  /  2020-05-31</h3>
<hr>


      </header>



<p>这个星期来PwC上班以后，第一次又重新干起了老本行，写VBA和做template （Excel Based）。</p>
<p>做template，最痛苦的事，莫过于design你的template。一方面要囊括尽可能多的，有用的信息给用户，另一方面又要考虑用户会怎么会去使用你的template (这一点我在悉尼大学工作的时候和Casey同学学习到了很多)。PwC又尤其注重你的效率，所以还得考虑到后续的功能增删所耗费的时间与精力。总之让我深刻体验到了，在非码农部门coding的痛苦。</p>
<ol>
<li>没有产品设计手册
咱们就来简化一点，也别来个手册文档了，能把要求说清楚就不错了，更别提能老老实实写在纸面上而且保证后面不赖账。说多了都是泪</li>
<li>不合理的预期
Coding 并不是万能药，尤其是在这么一个快节奏的工作环境，经常就是4,5个小时内就要开发完成，想想看这也不太可能。更别提VBA那个屎一样的coding 感受，真是欲仙欲死。</li>
</ol>
<p>吐槽完毕，开始聊聊我觉得有意识的地方。</p>
<h2 id="数组公式">数组公式</h2>
<p>好久没写数组公式了，这几天才反应过来，数组公式和R其实写起来感觉差不多，尤其如果你比较习惯R里面向量化的写法的话。</p>
<p>这是数组公式
<code>=SUM(A1:B7)</code>
这是R
<code>sum(x*y)</code></p>
<p>这是数组公式
<code>=IF(B1:B8&lt;&gt;&quot;Target&quot;,ROW(B1:B8),&quot;&quot;)</code>
这是R</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Target&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;a&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Target&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;c&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Target&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;a&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Target&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;c&#34;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">which</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;Target&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic">#&gt; [1] 1 3 5 7</span>
</code></pre></div><p>还是挺有意思的，逻辑都是对整个数组同时进行操作，只不过数组公式debug不太方便，一步步拆开检查</p>
<h2 id="alteryx">Alteryx</h2>
<p>自从一月份入职以来，我已经憋了好几百字的草稿吐槽Alteryx，准备啥时候好好写一写。</p>
<p>Alteryx最大的问题，就是操作的精细度不够。所有的东西都是一个数据框，一列。诚然，这对非技术背景的，非常友好。但是会有一些edge case, 超级蛋疼。</p>
<p>这和R里面的tidyverse是差不多的, tidyverse的管道传递的也是数据框, 但是R里面不只有tidyverse, R里面还可以操作到向量 - aka vector 这个级别。</p>
<p>举个例子，
Input data</p>
<table>
<thead>
<tr>
<th align="right">Emp</th>
<th align="left">Job</th>
<th align="right">Grade</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">1</td>
<td align="left">a</td>
<td align="right">6</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">b</td>
<td align="right">7</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">b</td>
<td align="right">8</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">c</td>
<td align="right">4</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">d</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>期待的结果</p>
<table>
<thead>
<tr>
<th align="right">Emp</th>
<th align="left">Job</th>
<th align="left">Grade</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">1</td>
<td align="left">a | b</td>
<td align="left">6 | 7 | 8</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">c | d</td>
<td align="left">4 | 5</td>
</tr>
</tbody>
</table>
<p>逻辑非常简单，按照Emp进行group by, 然后把所有Job和Grade的列都合并起来。</p>
<p>要是在Alteryx里面做，那可是真是要了亲命了，你需要无数个summarise tool, 先</p>
<ol>
<li>group by (Emp+Job) + group by Emp + Concat Job</li>
<li>group by (Emp+Grade) + group by Emp + Concat Grade</li>
<li>把1,2的结果，join on  Emp</li>
</ol>
<p>要是你有很多个field需要这样做（我指的是Job, Grade这样的），那你就等着哭吧，我有一次至少花了半个多小时来处理一个50多列的数据。</p>
<p>要是换了R，一句代码搞定，管你后面有多少个column呢</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data.table</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">setDT</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dt</span><span style="color:#000;font-weight:bold">)</span> 

<span style="color:#000">dt</span>
<span style="color:#8f5902;font-style:italic">#&gt;    Emp Job Grade</span>
<span style="color:#8f5902;font-style:italic">#&gt; 1:   1   a     6</span>
<span style="color:#8f5902;font-style:italic">#&gt; 2:   1   b     7</span>
<span style="color:#8f5902;font-style:italic">#&gt; 3:   1   b     8</span>
<span style="color:#8f5902;font-style:italic">#&gt; 4:   2   c     4</span>
<span style="color:#8f5902;font-style:italic">#&gt; 5:   2   d     5</span>

<span style="color:#000">dt[</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">lapply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.SD</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">paste0</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">unique</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">collapse</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34; | &#34;</span><span style="color:#000;font-weight:bold">)),</span><span style="color:#000">by</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">.(Emp</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">.SDcols</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000">]</span>
<span style="color:#8f5902;font-style:italic">#&gt;    Emp   Job     Grade</span>
<span style="color:#8f5902;font-style:italic">#&gt; 1:   1 a | b 6 | 7 | 8</span>
<span style="color:#8f5902;font-style:italic">#&gt; 2:   2 c | d     4 | 5</span>
</code></pre></div><p>当然了，R的学习曲线比Alteryx陡峭许多，比如上面这个代码，至少小白会问出这么几个问题，啥是<code>lapply</code>,<code>.SD</code>,<code>.SDcols</code>?</p>
<p>所以，每个工具都有自己的使用场景。Alteryx在PwC这种服务行业，不追求data钻研的深度，只追求按时deliver 一定quality的result, Alteryx恐怕还真是最好的选择。更别提每年超高的流失率，要是真的用R或者Python，那就估计以后只能招带着技能进组的新人了。实话实说，R和Python这种东西，就是会用的人，觉得很好用，不会coding,那就是百无一用。</p>
<p>希望以后还是能去一个能够对data钻研较深的位置，乙方有时候也不过就是工具人而已哈哈</p>
<h2 id="vba">VBA</h2>
<p>我对VBA还是很有感情的，毕竟我的第一门coding lannguage就是VBA （很不可思议吧，作为一个传统会计背景出身的人，这个选择还是很正确的）。我也是靠着VBA的技能，在澳洲找到了第一份实习，而且很不幸（？？？），后续的每一份工作都用到了VBA。之前在悉尼大学的短暂工作，也是靠着VBA技能与会计的双重背景，得到了这个机会。</p>
<p>VBA说起来也很有意思，PwC的working paper竟然是based on 一个个macro上的，是的，你没有看错，就是一个个xlsm文件。我现在觉得还有些不可思议 LOL</p>
<p>话说回来，VBA的缺点实在太多了，比如落后了一个世纪的VBE Editor，手动<code>debug.print</code> 打断点的痛苦，莫名其妙的报错。。。要说我能说一个晚上都不带停嘴的,以后慢慢吐槽吧。</p>

  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/cn/2018/11/pte-score-79-first-time/">PTE首战8炸攻略</a></span>
  <span class="nav-next"></span>
</nav>



<section class="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var disqus_js = '//Frank.disqus.com/embed.js';
    var d = document, s = d.createElement('script');
    s.src = disqus_js; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>



<script src="//yihui.org/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.org/js/center-img.js"></script>

  



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">© <a href="/">Dingrui(Frank) Zhang</a> 2020</div>
  
  </footer>
  </article>
  
  </body>
</html>

